import http.client
import json

conn = http.client.HTTPSConnection("app.vanta.com")

payload = "{\"operationName\":\"failingResourcesForTestResult\",\"variables\":{\"filter\":{\"testIds\":[\"password-manager-records-microsoft-endpoint-manager\"]},\"first\":50},\"query\":\"query failingResourcesForTestResult($filter: TestResultsFilter\\u0021, $first: Int\\u0021, $after: String) {\\\\n  organization {\\\\n    id\\\\n    name\\\\n    currentTestResults(filter: $filter) {\\\\n      id\\\\n      testId\\\\n      version {\\\\n        major\\\\n        minor\\\\n        __typename\\\\n      }\\\\n      name\\\\n      failingResourceEntities(first: $first, after: $after) {\\\\n        totalCount\\\\n        pageInfo {\\\\n          startCursor\\\\n          endCursor\\\\n          hasNextPage\\\\n          hasPreviousPage\\\\n          __typename\\\\n        }\\\\n        edges {\\\\n          node {\\\\n            id\\\\n            ...TestResourceEntityFields\\\\n            __typename\\\\n          }\\\\n          __typename\\\\n        }\\\\n        __typename\\\\n      }\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n}\\\\n\\\\nfragment TestResourceEntityFields on TestResourceEntity {\\\\n  id\\\\n  descriptor\\\\n  displayMetadata\\\\n  resource {\\\\n    ...ResourceEntityFields\\\\n    __typename\\\\n  }\\\\n  remediationTimeline {\\\\n    id\\\\n    detectionTime\\\\n    remediateBy\\\\n    __typename\\\\n  }\\\\n  __typename\\\\n}\\\\n\\\\nfragment ResourceEntityFields on ResourceEntity {\\\\n  createdAt\\\\n  displayName\\\\n  uid\\\\n  ... on FetchedResource {\\\\n    externalURL\\\\n    __typename\\\\n  }\\\\n  ... on Vendor {\\\\n    id\\\\n    url\\\\n    __typename\\\\n  }\\\\n  ... on AirtableTask {\\\\n    createdAt\\\\n    displayName\\\\n    uid\\\\n    externalURL\\\\n    taskCreatedAt\\\\n    taskClosedAt\\\\n    __typename\\\\n  }\\\\n  ... on AsanaTask {\\\\n    createdAt\\\\n    displayName\\\\n    uid\\\\n    externalURL\\\\n    taskCreatedAt\\\\n    taskClosedAt\\\\n    __typename\\\\n  }\\\\n  ... on AzureDevOpsTask {\\\\n    createdAt\\\\n    displayName\\\\n    uid\\\\n    externalURL\\\\n    taskCreatedAt\\\\n    taskClosedAt\\\\n    __typename\\\\n  }\\\\n  ... on ClickupTask {\\\\n    createdAt\\\\n    displayName\\\\n    uid\\\\n    externalURL\\\\n    taskCreatedAt\\\\n    taskClosedAt\\\\n    __typename\\\\n  }\\\\n  ... on ClubhouseTask {\\\\n    createdAt\\\\n    displayName\\\\n    uid\\\\n    externalURL\\\\n    taskCreatedAt\\\\n    taskClosedAt\\\\n    __typename\\\\n  }\\\\n  ... on GithubTask {\\\\n    createdAt\\\\n    displayName\\\\n    uid\\\\n    externalURL\\\\n    taskCreatedAt\\\\n    taskClosedAt\\\\n    __typename\\\\n  }\\\\n  ... on GitlabTask {\\\\n    createdAt\\\\n    displayName\\\\n    uid\\\\n    externalURL\\\\n    taskCreatedAt\\\\n    taskClosedAt\\\\n    __typename\\\\n  }\\\\n  ... on JiraTask {\\\\n    createdAt\\\\n    displayName\\\\n    uid\\\\n    externalURL\\\\n    taskCreatedAt\\\\n    taskClosedAt\\\\n    __typename\\\\n  }\\\\n  ... on LinearTask {\\\\n    createdAt\\\\n    displayName\\\\n    uid\\\\n    externalURL\\\\n    taskCreatedAt\\\\n    taskClosedAt\\\\n    __typename\\\\n  }\\\\n  ... on MondayTask {\\\\n    createdAt\\\\n    displayName\\\\n    uid\\\\n    externalURL\\\\n    taskCreatedAt\\\\n    taskClosedAt\\\\n    __typename\\\\n  }\\\\n  ... on PivotalTrackerTask {\\\\n    createdAt\\\\n    displayName\\\\n    uid\\\\n    externalURL\\\\n    taskCreatedAt\\\\n    taskClosedAt\\\\n    __typename\\\\n  }\\\\n  ... on TrelloTask {\\\\n    createdAt\\\\n    displayName\\\\n    uid\\\\n    externalURL\\\\n    taskCreatedAt\\\\n    taskClosedAt\\\\n    __typename\\\\n  }\\\\n  ... on EC2Instance {\\\\n    createdAt\\\\n    displayName\\\\n    uid\\\\n    requiredExternalURL: externalURL\\\\n    __typename\\\\n  }\\\\n  ... on GCPContainerRepository {\\\\n    createdAt\\\\n    displayName\\\\n    uid\\\\n    requiredExternalURL: externalURL\\\\n    __typename\\\\n  }\\\\n  ... on AwsContainerVulnerability {\\\\n    createdAt\\\\n    displayName\\\\n    optionalExternalURL: externalURL\\\\n    uid\\\\n    resolvedWithinSLA\\\\n    severity\\\\n    packageIdentifier\\\\n    repositoryName\\\\n    findings {\\\\n      name\\\\n      description\\\\n      uri\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on AwsInspectorVulnerability {\\\\n    createdAt\\\\n    displayName\\\\n    uid\\\\n    requiredExternalURL: externalURL\\\\n    resolvedWithinSLA\\\\n    severity\\\\n    packageIdentifier\\\\n    packageName\\\\n    instanceId\\\\n    findings {\\\\n      cveId\\\\n      description\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on AzureContainerVulnerability {\\\\n    createdAt\\\\n    displayName\\\\n    optionalExternalURL: externalURL\\\\n    uid\\\\n    resolvedWithinSLA\\\\n    severity\\\\n    packageIdentifier\\\\n    repositoryName\\\\n    cves {\\\\n      name\\\\n      uri\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on GCPContainerVulnerability {\\\\n    createdAt\\\\n    displayName\\\\n    optionalExternalURL: externalURL\\\\n    uid\\\\n    repositoryName\\\\n    resolvedWithinSLA\\\\n    packageIdentifier\\\\n    severity\\\\n    occurrences {\\\\n      shortDescription\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on SnykVulnerability {\\\\n    createdAt\\\\n    displayName\\\\n    optionalExternalURL: externalURL\\\\n    uid\\\\n    snykPackageName: packageName\\\\n    identifiers\\\\n    projectName\\\\n    resolvedWithinSLA\\\\n    severity\\\\n    title\\\\n    __typename\\\\n  }\\\\n  ... on User {\\\\n    id\\\\n    imageUrl\\\\n    displayName\\\\n    email\\\\n    __typename\\\\n  }\\\\n  ... on VantaAgentMonitoredComputer {\\\\n    uid\\\\n    displayName\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    hostIdentifier\\\\n    osVersion\\\\n    serialNumber\\\\n    lastPing\\\\n    __typename\\\\n  }\\\\n  ... on AdpRunHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on BambooHrHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on BobHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on GustoHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on InsperityHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on JustworksHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on NamelyHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on PaychexFlexHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on PaycomHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on PaylocityHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on PersonioHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on QuickBooksHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on RipplingHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on SequoiaOneHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on SquarePayrollHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on TrinetHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on UltiProHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on WorkdayHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  ... on ZenefitsHrUser {\\\\n    displayName\\\\n    hrUserEmail: email\\\\n    vantaOwner {\\\\n      id\\\\n      imageUrl\\\\n      displayName\\\\n      email\\\\n      __typename\\\\n    }\\\\n    __typename\\\\n  }\\\\n  __typename\\\\n}\\\\n\"}"

headers = {
    'cookie':
    "__zlcmid=1CylNinE3GKMJHz; _cq_duid=1.1668634399.3QB6zJsTmK56NUw7; _gcl_au=1.1.1715281633.1668634400; _fbp=fb.1.1668634400384.2101305601; _rdt_uuid=1668634400439.48b9f35d-b69a-46a8-b067-d45207ab1694; ajs_user_id=null; ajs_group_id=null; ajs_anonymous_id=%2275d34349-b4f3-4d62-ac55-dd023e7ee168%22; cb_user_id=null; cb_group_id=null; cb_anonymous_id=%22322b19b7-0dd8-45e1-ad6c-04905295fb1a%22; _fcdscv=eyJDdXN0b21lcklkIjoiZDcxYzM0YzUtZTQ2YS00ZDAzLWFlYTgtNTUwM2E2ZTU4NGI0IiwiVmlzaXRvciI6eyJFbWFpbCI6bnVsbCwiRXh0ZXJuYWxWaXNpdG9ySWQiOiIyNWRjZGZkOS05MmFlLTRhNDAtYWJjOS05NWVhY2E1NmM5MDEifSwiVmlzaXRzIjpbXSwiQWN0aXZpdGllcyI6W10sIkRpYWdub3N0aWNNZXNzYWdlIjpudWxsfQ==; hubspotutk=62037a5fc6290b70b432c80b3910c669; _hp2_id.1537779549=%7B%22userId%22%3A%221522752892548592%22%2C%22pageviewId%22%3A%223937145054104765%22%2C%22sessionId%22%3A%223290572445916482%22%2C%22identity%22%3Anull%2C%22trackerVersion%22%3A%224.0%22%7D; _uetvid=4a71464065f611edb8fd4bae40ca92ef; __hstc=148015400.62037a5fc6290b70b432c80b3910c669.1668634400950.1668634400950.1669844090703.2; _ga=GA1.2.1773329569.1668634400; __q_state_875gDyGoGBpbHL2d=eyJ1dWlkIjoiZjFkNDNhNDctZmNkMi00NzUwLWJhZTItOTFjOTNiODIyMTQxIiwiY29va2llRG9tYWluIjoidmFudGEuY29tIiwibWVzc2VuZ2VyRXhwYW5kZWQiOmZhbHNlLCJwcm9tcHREaXNtaXNzZWQiOmZhbHNlLCJjb252ZXJzYXRpb25JZCI6IjEwMjA1NjAxMDIzMTU4OTMxOTcifQ==; _ga_SW5LK36MTJ=GS1.1.1669844089.3.1.1669845571.60.0.0; connect.sid=s%3AGcaOPGKGXZ04RGw58khH2-Dca-fX0v4W.%2Fm3zULvOT54hXLPk%2BpKaZpQNJeFI8hDf3nrAlFM2tr8; csrf-token=e948f191d484b3787e5a33c07a4e719b1673296ad1338ab19ca7e1b3b0bd8e1c; _gid=GA1.2.1740113503.1670367907; _hp2_ses_props.948124972=%7B%22r%22%3A%22https%3A%2F%2Fapp.vanta.com%2Ftests%3Fstandard%3Dsoc2%26tab%3DIT%22%2C%22ts%22%3A1670447055451%2C%22d%22%3A%22app.vanta.com%22%2C%22h%22%3A%22%2Ftests%22%2C%22q%22%3A%22%3Fstandard%3Dsoc2%26tab%3DEngineering%22%7D; _hp2_id.948124972=%7B%22userId%22%3A%226215448312345645%22%2C%22pageviewId%22%3A%221710661145463478%22%2C%22sessionId%22%3A%222862749948334536%22%2C%22identity%22%3A%2263842489c10d9fc4025236d3%22%2C%22trackerVersion%22%3A%224.0%22%2C%22identityField%22%3Anull%2C%22isIdentified%22%3A1%7D; userty.core.p.b970b0=__2VySWQiOiI2ZWJjZDc1YjY0NjgzZThjNmE5MzUwMjEzYjU0OTBlOSJ9eyJ1c; userty.core.s.b970b0=__SI6MTY3MDQ0OTE1NDAxMiwic2lkIjoiNDYyOGU2ODk3NTg1NGU5MTU5M2YyM2I1MWVlYTZlN2IiLCJzdCI6MTY3MDQ0NzM1NDAxMiwicHYiOjEsInJlYWR5Ijp0cnVlLCJ3cyI6IntcIndcIjo4NDYsXCJoXCI6MTAwMX0ifQ==eyJzZ; _dd_s=logs=1&id=4c896ed9-b49c-447e-8b43-df82cb1d137b&created=1670447055375&expire=1670448254117&rum=1",
    'authority':
    "app.vanta.com",
    'accept':
    "*/*",
    'accept-language':
    "en-US,en;q=0.9",
    'apollographql-client-name':
    "web-client",
    'apollographql-client-version':
    "c7a43a",
    'content-type':
    "application/json",
    'graphql-schema-version':
    "c7a43a",
    'origin':
    "https://app.vanta.com",
    'referer':
    "https://app.vanta.com/tests?standard=soc2&tab=IT",
    'sec-ch-ua':
    '"Google Chrome";v="107", "Chromium";v="107", "Not=A?Brand";v="24"',
    'sec-ch-ua-mobile':
    "?0",
    'sec-ch-ua-platform':
    '"macOS"',
    'sec-fetch-dest':
    "empty",
    'sec-fetch-mode':
    "cors",
    'sec-fetch-site':
    "same-origin",
    'user-agent':
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36",
    'x-csrf-token':
    "e948f191d484b3787e5a33c07a4e719b1673296ad1338ab19ca7e1b3b0bd8e1c"
}

payload = json.loads(payload)
query = payload.get("query").replace("\\\\n", "")
query = query.replace("\\\\", "")
query = query.replace("\n", "")
print(payload.get("query"))
payload["query"] = query
conn.request("POST", "/graphql", json.dumps(payload), headers)

res = conn.getresponse()
data = res.read()

print(data.decode("utf-8"))